<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø³Ø¤Ø§Ù„ Ù‚Ø¨Ù„ Ù…Ø§ ØªØ´Ø±ÙŠ</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body { font-family:'Segoe UI', sans-serif; background:#f5f6fa; color:#333; margin:0; }
header { background:#4a90e2; color:white; padding:1rem; text-align:center; }
.container { width:90%; max-width:1200px; margin:0 auto; }
.filter-box, .sort-box, .admin-box { background:white; padding:0.8rem; margin-bottom:1rem; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.filter-box input, .filter-box select, .sort-box select, .admin-box input { padding:0.4rem; border-radius:5px; border:1px solid #ccc; margin-bottom:0.5rem; }
.admin-box button { padding:0.5rem; background:#4a90e2; color:white; border:none; border-radius:5px; cursor:pointer; margin-bottom:0.3rem; }
.admin-box button:hover { background:#357ABD; }
.products-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(300px,1fr)); gap:1rem; }
.product-card { background:white; padding:1rem; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); display:flex; flex-direction:column; }
.product-card img { width:100%; height:200px; object-fit:cover; border-radius:10px; margin-bottom:0.5rem; }
.product-card h3 { color:#4a90e2; margin:0 0 0.3rem 0; }
.product-card .price { font-weight:bold; margin-bottom:0.3rem; }
.product-card .description { font-size:0.9rem; margin-bottom:0.3rem; color:#555; }
.product-card .stars { color:gold; margin-bottom:0.5rem; }
.question-form { background:#f9f9f9; padding:0.8rem; margin-bottom:0.5rem; border-radius:8px; display:flex; flex-direction:column; }
.question-form textarea { width:100%; padding:0.6rem; border:1px solid #ccc; border-radius:5px; resize:none; font-size:1rem; margin-bottom:0.5rem; }
.question-form button { padding:0.5rem; background:#4a90e2; color:white; border:none; border-radius:5px; cursor:pointer; transition:0.3s; }
.question-form button:hover { background:#357ABD; }
.questions-list { margin-top:0.5rem; font-size:0.9rem; color:#333; }
.pagination { display:flex; justify-content:center; gap:0.5rem; margin-top:1rem; }
.pagination button { padding:0.4rem 0.8rem; border:none; background:#4a90e2; color:white; border-radius:5px; cursor:pointer; }
.pagination button.active { background:#357ABD; }
.pagination button:hover { opacity:0.8; }
footer { text-align:center; padding:1rem; margin-top:2rem; background:#eee; font-size:0.9rem; color:#555; }

/* Modal Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */
#register-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
#register-modal div { background:white; padding:2rem; border-radius:10px; max-width:400px; width:90%; text-align:center; position:relative; }
#register-modal span { position:absolute; top:0.5rem; right:1rem; cursor:pointer; font-size:1.2rem; }
#register-modal input { width:90%; padding:0.5rem; margin:0.3rem 0; border-radius:5px; border:1px solid #ccc; }
#register-modal button { padding:0.5rem 1rem; margin-top:1rem; background:#4a90e2; color:white; border:none; border-radius:5px; cursor:pointer; }
#register-modal button:hover { background:#357ABD; }
</style>

<script>
// ğŸ”‘ Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBuJ6X1ufMy7Fm_DogCLqXm8ZHFpklXc80",
  authDomain: "sawal-qbl-ma-tchri.firebaseapp.com",
  databaseURL: "https://sawal-qbl-ma-tchri-default-rtdb.firebaseio.com",
  projectId: "sawal-qbl-ma-tchri",
  storageBucket: "sawal-qbl-ma-tchri.firebasestorage.app",
  messagingSenderId: "751469009438",
  appId: "1:751469009438:web:b3b89e582103bf78a0ac0f",
  measurementId: "G-P3K988L1SD"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

let userLoggedIn = false;
</script>

</head>
<body>

<header>
  <h1>Ø³Ø¤Ø§Ù„ Ù‚Ø¨Ù„ Ù…Ø§ ØªØ´Ø±ÙŠ</h1>
</header>

<div class="container">

  <!-- Admin Panel -->
  <div class="admin-box" id="admin-box">
    <h3>Admin Panel</h3>
    <input type="text" id="admin-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
    <input type="number" id="admin-price" placeholder="Ø§Ù„Ø³Ø¹Ø±">
    <input type="number" id="admin-rating" placeholder="ØªÙ‚ÙŠÙŠÙ… 1-5">
    <input type="text" id="admin-img" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
    <input type="text" id="admin-desc" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬">
    <button id="add-product-btn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
  </div>

  <!-- Filters -->
  <div class="filter-box">
    <input type="text" id="product-search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">
    <label>Ø£Ù‚Ù„ Ø³Ø¹Ø±:
      <input type="range" id="price-slider" min="0" max="10000" step="100" value="10000">
      <span id="price-value">10000</span> Ø¯Ø±Ù‡Ù…
    </label>
    <label>ØªÙ‚ÙŠÙŠÙ… â‰¥
      <select id="rating-filter">
        <option value="0">ÙƒÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</option>
        <option value="1">1â­</option>
        <option value="2">2â­</option>
        <option value="3">3â­</option>
        <option value="4">4â­</option>
        <option value="5">5â­</option>
      </select>
    </label>
  </div>

  <div class="sort-box">
    <label>ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨:
      <select id="sort-select">
        <option value="none">Ù„Ø§ Ø´ÙŠØ¡</option>
        <option value="price-asc">Ø§Ù„Ø³Ø¹Ø±: Ø§Ù„Ø£Ù‚Ù„ Ø£ÙˆÙ„Ø§Ù‹</option>
        <option value="price-desc">Ø§Ù„Ø³Ø¹Ø±: Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø£ÙˆÙ„Ø§Ù‹</option>
        <option value="rating-desc">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø£ÙˆÙ„Ø§Ù‹</option>
        <option value="rating-asc">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: Ø§Ù„Ø£Ù‚Ù„ Ø£ÙˆÙ„Ø§Ù‹</option>
      </select>
    </label>
  </div>

  <div class="products-grid" id="products-grid"></div>
  <div class="pagination" id="pagination"></div>

</div>

<!-- Modal ØªØ³Ø¬ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø± -->
<div id="register-modal">
  <div>
    <h3>Ø¨Ø§Ø´ ØªÙƒÙ…Ù„</h3>
    <p>Ø®Ø§ØµÙƒ ØªØ³Ø¬Ù„ Ø¨Ø§Ø´ ØªÙ†Ø´Ø± Ø§Ù„Ø³Ø¤Ø§Ù„ Ø£Ùˆ Ø§Ù„ØªØµÙˆÙŠØª.</p>
    <input type="email" id="modal-email" placeholder="Email">
    <input type="password" id="modal-password" placeholder="Password">
    <button id="modal-signup-btn">Ø³Ø¬Ù„ Ø¯Ø§Ø¨Ø§</button>
    <span onclick="closeModal()">&times;</span>
  </div>
</div>

<footer>
  Â© 2026 Ø³Ø¤Ø§Ù„ Ù‚Ø¨Ù„ Ù…Ø§ ØªØ´Ø±ÙŠ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©
</footer>

<script>
let productsPerPage = 4;
let currentPage = 1;
let allProducts = [];
let filteredData = [];

// Admin Add Product
document.getElementById('add-product-btn').addEventListener('click',()=>{
  const name = document.getElementById('admin-name').value;
  const price = parseInt(document.getElementById('admin-price').value);
  const rating = parseInt(document.getElementById('admin-rating').value);
  const img = document.getElementById('admin-img').value;
  const desc = document.getElementById('admin-desc').value;
  if(!name||!price||!rating||!img||!desc) return alert('Ø§ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„!');
  const id = name.toLowerCase().replace(/\s+/g,'-');
  db.ref('products/'+id).set({name,price,rating,img,desc});
  alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!');
  document.getElementById('admin-name').value='';
  document.getElementById('admin-price').value='';
  document.getElementById('admin-rating').value='';
  document.getElementById('admin-img').value='';
  document.getElementById('admin-desc').value='';
});

// Fetch Products
function fetchProducts(){
  db.ref('products').on('value', snapshot=>{
    const data = snapshot.val();
    if(!data) return;
    allProducts = Object.keys(data).map(key=>({id:key,...data[key]}));
    applyFilters();
  });
}

// Display Products
function displayProducts(){
  const grid = document.getElementById('products-grid');
  grid.innerHTML='';
  const start=(currentPage-1)*productsPerPage;
  const end=start+productsPerPage;
  const pageData = filteredData.slice(start,end);
  pageData.forEach(p=>{
    const stars = 'â­'.repeat(p.rating)+'â˜†'.repeat(5-p.rating);
    const card = document.createElement('div');
    card.className='product-card';
    card.innerHTML=`
      <img src="${p.img}" alt="${p.name}">
      <h3>${p.name}</h3>
      <p class="price">Ø§Ù„Ø³Ø¹Ø±: ${p.price} Ø¯Ø±Ù‡Ù…</p>
      <p class="description">${p.desc}</p>
      <p class="stars">${stars}</p>
      <div class="question-form">
        <textarea rows="3" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..."></textarea>
        <button>Ù†Ø´Ø± Ø§Ù„Ø³Ø¤Ø§Ù„</button>
      </div>
      <div class="questions-list"></div>
    `;
    grid.appendChild(card);

    const submitBtn = card.querySelector('button');
    const questionsDiv = card.querySelector('.questions-list');

    // Submit question
    submitBtn.addEventListener('click',()=>{
      const question = card.querySelector('textarea').value;
      if(!question) return alert('Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø£ÙˆÙ„Ø§Ù‹');
      const id = Date.now();
      db.ref('questions/'+id).set({question,product:p.name,user:'Ø²Ø§Ø¦Ø±'});
      alert('ØªÙ… Ù†Ø´Ø± Ø³Ø¤Ø§Ù„Ùƒ!');
      card.querySelector('textarea').value='';
    });

    // Load questions for this product
    db.ref('questions').orderByChild('product').equalTo(p.name).on('value', snapshot=>{
      const data = snapshot.val();
      questionsDiv.innerHTML = '';
      if(data){
        Object.keys(data).forEach(key=>{
          const q = data[key];
          const qEl = document.createElement('p');
          qEl.textContent = "â“ " + q.user + ": " + q.question;
          questionsDiv.appendChild(qEl);
        });
      }
    });

  });
  setupPagination();
}

// Pagination
function setupPagination(){
  const paginationDiv=document.getElementById('pagination');
  paginationDiv.innerHTML='';
  const pageCount=Math.ceil(filteredData.length/productsPerPage);
  for(let i=1;i<=pageCount;i++){
    const btn=document.createElement('button');
    btn.textContent=i;
    if(i===currentPage) btn.classList.add('active');
    btn.addEventListener('click',()=>{ currentPage=i; displayProducts(); });
    paginationDiv.appendChild(btn);
  }
}

// Filters + Sort
const searchInput=document.getElementById('product-search');
const priceSlider=document.getElementById('price-slider');
const priceValue=document.getElementById('price-value');
const ratingFilter=document.getElementById('rating-filter');
const sortSelect=document.getElementById('sort-select');

priceSlider.addEventListener('input',()=>{ priceValue.textContent=priceSlider.value; applyFilters(); });
searchInput.addEventListener('input',applyFilters);
ratingFilter.addEventListener('change',applyFilters);
sortSelect.addEventListener('change',applyFilters);

function applyFilters(){
  const query=searchInput.value.toLowerCase();
  const priceLimit=parseInt(priceSlider.value);
  const ratingLimit=parseInt(ratingFilter.value);
  filteredData = allProducts.filter(p=> p.name.toLowerCase().includes(query) && p.price<=priceLimit && p.rating>=ratingLimit );
  const value = sortSelect.value;
  if(value==='price-asc') filteredData.sort((a,b)=>a.price-b.price);
  else if(value==='price-desc') filteredData.sort((a,b)=>b.price-a.price);
  else if(value==='rating-asc') filteredData.sort((a,b)=>a.rating-b.rating);
  else if(value==='rating-desc') filteredData.sort((a,b)=>b.rating-a.rating);
  currentPage=1;
  displayProducts();
}

fetchProducts();
</script>

</body>
</html>
